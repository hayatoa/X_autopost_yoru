name: X Auto Post (time-window)
on:
  schedule:
    # 前の時刻の45〜59分（3分おき）= JST側の直前15分
    - cron: "45-59/3 14,17,20,23,2,5,8,11 * * *"
    # 対象時刻の0〜15分（3分おき）= JST側の直後15分
    - cron: "0-15/3 15,18,21,0,3,6,9,12 * * *"
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    env:
      PYTHONUNBUFFERED: "1"
      TZ: Asia/Tokyo
      SHEET_ID: ${{ secrets.SHEET_ID }}
      GCP_SA_JSON: ${{ secrets.GCP_SA_JSON }}
      X_API_KEY: ${{ secrets.X_API_KEY }}
      X_API_SECRET: ${{ secrets.X_API_SECRET }}
      X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
      X_ACCESS_TOKEN_SECRET: ${{ secrets.X_ACCESS_TOKEN_SECRET }}
      SHEET_TAB: x_autopost_yoru
      WINDOW_MIN: "15"
      FORCE_ONE: "0"
      DRY_RUN: "0"
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Show head of auto_post.py before run
        run: sed -n "1,80p" auto_post.py
      - name: Run poster (time-window)
        run: python auto_post.py
